<!DOCTYPE html>
<!-- 2apr2023
т.к. обнаружирось что прога крашится почти любом входящем значении, счел нужным составить список допустимых значений. в listbox. ну и пока что работает только с формулами. 
-->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/x-icon" href="
data:image/gif;base64,R0lGODlhEAAQAPcAAP7+/vT0/mmb1Rj8jBn+i////////f///tzF//9R/ADwh8TP+jTlsA3fl0vSvODf/8mk+f9o+DWzs/39/eTp/91K9DmksgD/cgX/fQDyhKbR6dCN+P948niM0uS5//9x/7p09RD/gx7/jgn/gQH1g5/j4+90//9y/n1c6cTU5sHM7qrA3ZS8yld2sWFrmjtMnwL/gRv9jBf+igz/ggX/gkuZvpKUzwCqpy+SZA6DRhCGRxiOShSATyeLTyNVbg//ihz9ixj+ixn+ihP/hgj4gxH/ewCwpDWUajWWaSyEaDOIYSxPeBH/kRr9ihr/ixTtihv7hA+dsh2MUSSQVSuWWSiHXjWMXDBUdhX/kh39ixj/iRD0hhn/gQqoq4m0vWWbrEmLmS+FggNlaghzVAxYZQD/fxL/hgf/gA7RlTbGpQC9mvSw//9y/7pc/xD/iB7+jhD/hAD+flHoueJj//9r/1Vk3NfX//9d9GqQyQX/eQ3/hQD/fmLJy9qI/f9784SA2ZqV9ADajgD/agDakZnR4v/+/8ic9/9s9UiovP/j///9/9q9//9Y/Qjilv7+/f3//f3+/ejw/1ZgzQD/Zuju/J3k24TlzgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQFewAFACwAAAAAEAAQAAAI5wABCBSYAodBLwMTDiygIgcOKV8KKBw4ocAKHUemgCkwYeKBAwVY7EBCJUyBjwkLFKDgoQWPJFXErLGjcuGCCh9c9FBiZQybO4AKOBJYgIEFEC98LLlCpg2eQAUMEG1wIQSMH0ywlHGTR1CioQAKOMAgIgaQJlmavNEzSNEjog8yjJARpK4MOHsIFYAk0EABDSRmCCFAwEwcPoU4CgRZoASNIU60nJGjEmUABBA2mKhB5MkWNHP6GFoUCYCABBE4nLBRBAqXNHT8HGIkidIABRI6oLhhJEoXNXX+IGo0qRLh48iTE7AUEAA7">




  
  <title>Kastle</title>
  <style>
  /* прога урожденная k/!frontend/zamok22/20/9.html */
  .palet {display:flex;}
  .palet .color {width:24px; height:24px;background: white;border:1px solid blue;}
.opo{
	background: #FFFFFF;
	padding: 13px;
	margin: auto;
}
.kod {
display: flex;
justify-content: flex-start;
align-items: flex-end;
}
.mara {
	background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAATCAIAAAAS8MqlAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAEsSURBVDhPnZC9TsMwFIV5RXZ4BF6BjpHYwgQrCxLpEDEQJ6FlohJMaQOoQvyUhZaGspHE8U+55lbErU0j9egosm/O5yN76zsvNrDCTg09Pb/oIdMLbK4Jtp3O5XrSjsE3iqI1ZI2lb5+9x2wuZRzHwIRhSAjRo7qX2iRAUsKiZegiCOxYOoK2KelP2rdjyP2esxCS3e6VBZNSSCG44CDEVLWaCdy6rvtH1thglPWGU5JMvJt3zB2cP+x7d1wIx3GAQa1icCpWMc4Qg4kacg7r2dcMbMEGr9n18CNIxmfLbXsn6e5xf/swgYkF04UYY7xiVVVRCqYlTFYxXb7v123te9V2ZGszDW8AIdVBS1oWpXLejMFvbGt5qm3HejfTiJlqxv4TBuxYozfC8uIHUDp6oFBQcH0AAAAASUVORK5CYII=);
	background-size: cover;
	cursor: pointer;
	width: 27px;
	height: 30px;
	margin-left:-27px;
	margin-bottom:20px;	
} 
.kod article{align-self: flex-start}

#svg{border: 2px solid purple;}
.btn0{border:2px solid purple;
padding:6px;border-radius:40%;}
button{cursor: pointer;
border:1px solid purple;
padding:3px;border-radius:6px;
}
#vvod{width:444px;}
[id^='rok']{display:none;}/* перермещение точек пиалы */
[id^='rok']:checked + * {background-color: cyan;border-radius:0;}
  </style>
</head>
<body>
<div class="kod">
	<svg id="svg" width="700" height="415" viewBox="0 0 700 415" fill="none">
	<style type="text/css">
	.rect1, .polygon1 {stroke: blue;}
	.txt1 {font-family: Arial; font-size: 24px; line-height: 0; fill:white;}
	</style>
		<rect x="0" y="0" width="700" height="250" fill="silver" />
	</svg>
	<div class="mara" onclick="cpy(this.parentElement);" title="Copy"></div>
	<article>
		<input type="radio" id="rok0" name="rokki">
		<button id="x0" style="border-width:3px;"
		onclick="rok0.checked=true;kx='dotx0';ky='doty0'">x</button><br>
		
		<input type="radio" id="rok1" name="rokki">	
		<button id="x1" onclick="rok1.checked=true;kx='dotx1';ky='doty1'">x</button><br>
		
		<input type="radio" id="rok2" name="rokki">		
		<button id="x2" onclick="rok2.checked=true;kx='dotx2';ky='doty2'">x</button><br>
		
		<input type="radio" id="rok5" name="rokki">	
		<button id="x5"   style="border-width:3px;" 
		onclick="rok5.checked=true;kx='dotx5';ky='doty5'">x</button><br>		
		
		<input type="radio" id="rok3" name="rokki">	
		<button id="x3"
		onclick="rok3.checked=true;kx='dotx3';ky='doty3'">x</button><br>
		
		<input type="radio" id="rok4" name="rokki">	
		<button id="x4"
		onclick="rok4.checked=true;kx='dotx4';ky='doty4'">x</button><br>
		
		
	</article>
</div>
<br>

<select id="selen" style="width:440px" onchange="vvod.value=this.value; main()">
  <option value="a(aa(c)zz)z" selected>a(aa(c)zz)z</option>a(aa(c)zz)z
  <option value="a12(c)zzz">a12(c)zzz</option>
  <option value="a12czzz">a12czzz</option>  
  <option value="acz">acz</option>  
  <option value="a(c)z">a(c)z</option>
  <option value="aaa(c)zzz">aaa(c)zzz</option> a(a(a(c)z)z)z
  <option value="a(a(a(c)z)z)z">a(a(a(c)z)z)z</option>  
  <option value="a(a(a(c)z)z-c-a(a(a(c)z)z)z-c-a(a(c)z)z)z">a(a(a(c)z)z-c-a(a(a(c)z)z)z-c-a(a(c)z)z)z</option>  
  
</select><br>

<input id="vvod" type="text" value="a(c)z">
<button class="btn0" type="button" onclick="
ss=vvod.value; main();
//window.navigator.clipboard.writeText(`nova.product.help@gmail.com`);
">do</button>

<br>
<textarea id="ta1" rows="20" cols="90" style="display:none;color: white; background: #1e154f;">
&lt;p&gt;
&lt;a&gt;
&lt;div&gt;&lt;img&gt;&lt;img&gt;&lt;img&gt;&lt;img&gt;&lt;/div&gt;
&lt;div&gt;&lt;img&gt;&lt;img&gt;&lt;img&gt;&lt;img&gt;&lt;/div&gt;
&lt;/a&gt;
&lt;/p&gt;
</textarea>

<textarea id="cop" rows="1" cols="90" style="position:absolute; left:-9999px; color: white; background: green;" title="используется для копирования">
</textarea>
<br>

<article class="palet">
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>	
	<div class="color"></div>	
</article>

<h2 id="la" style="font-family: sans-serif"></h2>

<script>
  yrr={// модель чаши
	  dotx0:-9,doty0:-24, // ножка
	  dotx1:34,doty1:-41, // изгиб ножки
	  dotx2:27,doty2:-6, // внешний изгиб края
	  dotx5:2,doty5:-43, // край	  
	  dotx3:-2,doty3:-37, // внутренний изгиб края
	  dotx4:38,doty4:-31, // изгиб дно

	  } 
  let kx='dotx1',ky='doty1';
  let z=-17;
  let hey=415;// высота svg
let mainColor='red';
const cc=['red','white','black','green','yellow','lime',
'violet','purple','navy','aqua','blue','gold',
'teal','olive','maroon','silver','springgreen','#6c757d','fuchsia'];
document.querySelectorAll('.color').
	forEach((x,i)=>{x.style.background=cc[i]; 
		x.addEventListener('click',(e)=>{mainColor=cc[i]})
		}); 
/************************************/
let stek4=[]; // рюмашки
let city=0.9;// opacity прозрачность фигур

let off; // смещение композиции к центру
let dx=40;//100;//20;//34;//  
let x11x=0,y11y=hey-15//180;//+50dx  
let s700=700;//

const dy=-25; // 
  
const clr=()=>{ta1.value=""}

function ff(x){
const cre=x=>{
	let r = /-/ig;
	let t, a=[];
	while (t =r.exec(x))a.push(t.index); 
	return a  
	}  

let e,xe,xd,n,i,s3,s4;

let a=cre(x);  //a: array of integer;
for (let i=0; i<a.length; i++){//i
	n=a[i];
	e=''; d='';
	xe=0; xd=0;
	for (let j=1;j<=Math.min(a[i],x.length-a[i]); j++) {//j 
		n--;
		d=d+x[a[i]+j];
		e=x[a[i]-j]+e;
		switch(x[a[i]-j]){
		case 'z': {xe++; break}
		case 'a':
		case '1':
		case '2': {xe--; break}
		   }   
		switch(x[a[i]+j]){
		case 'a':
		case '1':
		case '2': {xd++; break}
		case 'z': {xd--; break}
		}

		if ((xe<0)||(xd<0)) break;	  
		if ((xe===xd)&&(xd===0)&&(e===d)) {	  
		
		s3=x.substring(0,n); //  от индекса a до индекса b 
		s4=x.substring(n); // от n до конца
		//console.log(e);
		let r=new RegExp("("+e+")(-\\1)+",'g');
		//let s="aadz-aaezfzz-aadz-aaezfzz-aadz-aaezfzz-aadz-aaezfzz-aadz-aaezfzzz-a(agz)zhzz";
		//s=s.replace(/(aadz-aaezfzz)(-\1)+/gi,'($1)');
		s4=s4.replace(r,'($1)');
		//s4=s4.replace(/([^-]+)(-\1)+/gi,'($1)')
		return s3 + ff(s4);
		}
	}//j
}//i
return x;
}//func ff	

function main(){// отрисовка
let alf="abcdefghijklmnopqrstuvwxyz";
stek4=[];
/*высушить*/
s=ta1.value;
s=s.replace(/\n/g,'_');//в одинарных тегах теперь эти палки делают их неузнаваемыми
s=s.replace(/<!--.*-->?/g,'_');
//s=s.replace('_','');
let d='';
let b=false;
for (let i=0; i<s.length; i++){// теги переношу атрибуты нет
	switch (s[i]) {
		case '<':{d=d+'<'; b=!b; break}
		case '>':{d=d+'>'; b=false; break}
		case ' ':{if (b) b=false; break}
		case '_': break;
		default: {if (b) d=d+s[i]}
	}//switch
}
s=d;
//console.log(s);
['<br>','<hr>','<meta>','<!doctype>',
//'<sc'+'ript>','</sc'+'ript>',
'<style>','</style>',
'<title>','</title>',
'<head>','</head>',
//'<header>','</header>',нет это теги уничтожаемые как мусор
'<html>','</html>',
'<i>','</i>','<b>','</b>',
'<link>',
'<strong>','</strong>',
'<sub>','</sub>','<sup>','</sup>',
'<tt>','</tt>',
'<source>',//одинарные неизвестные теги глушат движок
'<center>','</center>',
].forEach(x=>{
	let y=new RegExp(x,'g');
	s=s.replace(y,'');
	});

//////////////////////////////////// заглушить
  s=s.replace(/(<sc?ript>.*?<\/sc?ript>)/gi,'');//анти скрипт
  s=s.replace(/(<style>.*?<\/style>)/gi,'');//анти style 
  s=s.replace(/(<svg>.*?<\/svg>)/gi,'<svg>');//анти svg  
  s=s.replace(/(<table>.*?<\/table>)/gi,'<table></table>');//анти table  
  s=s.replace(/(<pre>.*?<\/pre>)/gi,'');//анти svg   
  
  const closeli=x=>{// закрывает незакрытые лишки
	  x=x.replace(/<\/li>/gi,'');
	  x=x.replace(/<li>/gi,'</li><li>');
	  x=x.replace(/(<\/[uo]l>)/gi,'</li>$1'); // </ul> => </li></ul>
	  x=x.replace(/(<[uo]l>)<\/li>/gi,'$1');// <ul></li> => <ul>    
	  return x;
  }  
  s=closeli(s);// закрывает незакрытые лишки
  //console.log(s);	
//console.log(s);return 0;  
/*заменить*/ 
  let sp=['li'],sp2=['b'];
  while ((/<([^>]+)><\/\1>|<img>|<input>|<svg>/i).test(s)){// крыши
	let g=s.match(/<([^>]+)><\/\1>|<(img)>|<(input)>|<(svg)>/i);
	g=g[1]||g[2]||g[3]||g[4];
	if(!(sp.indexOf(g)+1)){sp.push(g); sp2.push(alf[sp.length])};
	let w=' _'+sp2[sp.indexOf(g)]+'_ ';
	switch (g){
		case 'img':{s=s.replace(/<img>/i,w); break}
		case 'svg':{s=s.replace(/<svg>/i,w); break}
		case 'input':{s=s.replace(/<input>/i,w); break}
		case 'h2':{s=s.replace(/<h2><\/h2>/i,w); break}
		case 'li':{s=s.replace(/<li><\/li>/i,w); break}  // лишки крышки
		case 'a':{s=s.replace(/<a><\/a>/i,w); break} 
		default :{s=s.replace(/<([^>]+)><\/\1>/i,w); break}
	}//switch
  }//while	
s=s.replace(/<ul>|<ol>/gi,'1'); 
s=s.replace(/<li>/gi,'2');   
s=s.replace(/(<[^\/]+?>)/gi,' a ');
s=s.replace(/(<\/.+?>)/gi,' z ');  
s=s.replace(/[<> _]/gi,'');  
s=s.replace(/za/gi,'z-a');//отступы меж башнями
s=s.replace(/z2/gi,'z-2');// 
s=s.replace(/z1/gi,'z-1');//
s=s.replace(/az/gi,'3');//
s=s.replace(/b+/gi,'b');//c лишками крышками//
s=s.replace(/([cdefghijklmnopqrstuvwxy])(\1)+/gi,'$1-$1');//32 audio сжать в один
mc=s.match(/(2[^-\r\n]+)/gi);// разбираюсь с лишками
//console.log('s>>',s);//aaac-czc-cz-aac-cz-ac-cz-ac-czc-czcz
//console.log(s);return 0; //aac-czdaezdaezdaezdaezz
if (!!mc) mc.forEach(x=>{let y=new RegExp(x+'-'+x,'g');s=s.replace(y,x)});
s=ff(s);// сокращения 
console.log(s);//return 0; //aa(c)zdaezdaezdaezdaezz
let dom=[];
let brk=s.split('').map(x=>0);
let war=s.split('').forEach((x,i)=>{
	if (x==='(')dom.push(i);
	if(x===')'){brk[i]=dom.pop();brk[brk[i]]=i}});
//console.log(brk);
//console.log(s.indexOf('-('));
let bz=s.split('');

for (let i=0; i<bz.length; i++){if(bz[i]==='-'&&bz[i+1]==='(')
	{bz[i+1]='['; bz[brk[i+1]]=']'}}
for (let i=1; i<bz.length; i++){if(bz[i]==='-'&&bz[i-1]===')')
	{bz[i-1]=']'; bz[brk[i-1]]='['}}	
s=bz.join('');
  //console.log(s);

  //console.log('sp> ',sp);
  //console.log('sp2> ',sp2);  
//***************************************** отладка 
  s='3-a(c)z-a(a(c)z)z-a(a(a(c)z)z)z-aaczz';
s='aa(c)zc-aa(c)zcz-b-bz';//-0-aa(c)z-0z-30

s=vvod.value;
s=s.replace(/2\(/g,'a(');
s=s.replace(/a\(/g,'(');// попробую так 4.4.23
s=s.replace(/\)z/g,')');
//*******************************************  
  //console.log('s> ',s);
  la.innerHTML=s;
  
//////////////////////////////////////draw формирует свг

const svg=document.querySelector('#svg');
svg.setAttribute("width", s700);
svg.setAttribute("viewBox", "0 0 "+s700+" "+hey);

svg.innerHTML=sq6();// стиль

const bab=x=>((' '+ss+' ')[x]==='('&&(' '+ss+' ')[x+2]===')');// один в кольце

//******** преотрисовка ... графические примитивы
const recta=(axe,x1,y1,x2,y2,m,n)=>{
	switch (m){
		case 'a': {svg.innerHTML+=sq7(axe,off+x1,y1,x2,y2,m,n);break}//rect	
		case '1': {svg.innerHTML+=sq8(axe,off+x1,y1,x2,y2,m,n);break}//ul	
		case '2': {svg.innerHTML+=sq9(axe,off+x1,y1,x2,y2,m,n);break}//li	
		}//switch
	}
const trg0=(axe,x1,y1,t)=>{
	svg.innerHTML+=sq5(axe,off+x1,y1);// треуг
	let name0=sp[sp2.indexOf(t)];
	let y0=(name0.length===1)?55:35;
	svg.innerHTML+=sq4(axe,off+x1,y0,name0);// надпись
	}
const trg3=(axe,x1,y1)=>{
	svg.innerHTML+=sq3(axe,off+x1,y1);// полигон
	}
const rng=(axe,x1,y1,x2)=>{
	svg.innerHTML+=sq2(axe,off+x1,y1,x2);// эллипс
	}
/*******************
первый и второй стеки пусты на выходе из ханойской сортировки, из них не берется для отрисовки.
нахуя их два? это намек что они могут пересекаться?
несмог представить случай a(z), всетаки стек будет один
*/

 
let axe=1.0;
let stek3=[]; // квадраты и труги, кольца...порядок рисования
//******************************************
///////**********ханойская сортировка begin
/*обьекты внутри кольца проигрывают в высоте, надо 
для них акселератор чтоли какойто добавить. а-ля гормон 
роста. лучше всем добавить но одним множитель единица, другим два.
*/
let ss=s;
const u={
	'0':{x:dx,y:0,},
	'a':{x:0,y:dy,},	
	'1':{x:dx/2|0,y:dy,},
	'2':{x:0,y:dy,},
	'3':{x:dx,y:0,},
	'-':{x:dx/2|0,y:0,},
	'(':{x:dx/2|0,y:dy,},//
	')':{x:dx/2|0,y:-dy,},//
	'[':{x:dx/2|0,y:dy,},
	']':{x:dx/2|0,y:-dy,},
	'z':{x:0,y:-dy,},	
	};
let x1x=x11x,y1y=y11y;// точка отсчета
//alert(x1x+' '+y1y);
	svg.innerHTML+=// начало пути черепашки
`<circle 
	r="3" 
	cx="${x1x}" 
	cy="${y1y}" 
	fill="violet"/>`;
//svg.innerHTML+=sq1;// стартовая точка контура
let j=0;
let stk=[]; // 
for (let i=0; i<ss.length; i++){// ханойская сортировка
	let n=ss[i];
	n=n.replace(/[bcdefghijklmnopqrstuvwxy]/gi,'0');

	let ak='black';

	//let ell=u['('].x/2;//0;//
	switch (n){
		case '(':{axe=2.3;stk.push({x:x1x,y:y1y,axe: axe,});break}//*
		case ')':{let v=stk.pop();//*
			axe=v.axe;
			stek3.push({
				x1:v.x,
				y1:v.y,
				x2:x1x-v.x+u[n].x,//,
				m:'(',
				sort:y1y+1,
				axe: v.axe,
				});
			break}
			/*
		case '[':{stk.push({x:x1x,y:y1y});break}//*
		case ']':{let v=stk.pop();//*
			stek3.push({
				x1:v.x,
				y1:v.y,
				x2:x1x+u[n].x,
				m:'[',
				sort:y1y+1,
				});
			break}
*/			
		case 'a':{axe=1.5;//if(ss[i+1]!=='(')
				  stk.push({x:x1x,y:y1y-dy,m:n,axe: axe,});ak='green';break}
		case '1':{axe=2.0;stk.push({x:x1x,y:y1y-dy,m:n,axe: axe,});ak='green';break}
		case '2':{axe=0.5;stk.push({x:x1x,y:y1y-dy,m:n,axe: axe,});ak='green';break}
		case '0':{
				
				stek3.push({
					x1:x1x,
					y1:y1y,////
					m:(bab(i))?'3':n,// заключено в скобки
					sort:y1y,
					t:ss[i],//
					axe: 2.5,
					}); 
				break}
		case '3':{//
				stek3.push({
					x1:x1x,
					y1:y1y,
					m:n,
					sort:y1y,
					axe: 1.1,
					});
				break}
		case '-':{break}
		case 'z':{let t;//if(ss[i-1]!==')')
			t=stk.pop(); ak='red'; 
			if (!t) break;// стек исчерпался
			// а черепаха-то знает чем ты тут занимаешься?
			axe=t.axe;
			//if(ss[i-1]!==')')
			{stek3.push({
				x1:t.x,
				y1:(t.y+dy),///
				x2:(x1x-u[n].x)-t.x,
				y2:-dy,
				m:t.m,
				sort:Math.max(t.y+dy,t.y),
				axe:t.axe,
				});
			j++;}
			break} 
	}//switch
	if(u.hasOwnProperty(n)){
		x1x+=u[n].x;
		y1y+=u[n].y*axe;//
		}
	/*             это пригодится 
	svg.innerHTML+=
`<circle 
	r="3" 
	cx="${x1x}" 
	cy="${y1y}" 
	fill="${ak}"/>`;// точки контура
	 */
};//i
///////**********ханойская сортировка end
//****************************************
off=(700-x1x)/2;
{// стекер-3 ☯

stek3=stek3.sort((a,b)=>b.s-a.s); //сортировка точечная нотация
console.clear();
stek3.forEach(x=>console.table(x));
stek3.forEach((x,j)=>{
	switch (x.m){
		//блоки
		case '(': {rng(x.axe,x.x1,x.y1,x.x2,); break}
		case '[': {rng(x.axe,x.x1,x.y1+dy,x.x2,); break}				
		//case '1':
		//case '2':
		//case 'a':{recta(x.axe,x.x1,x.y1,x.x2,x.y2,x.m,1,);break}
		//элементы
		//case '0':{trg0(x.axe,x.x1,x.y1,x.t);break}// alert(x.t)
		//case '3':{trg3(x.axe,x.x1,x.y1,); break}//150+j*5
	}//switch
});//forEach 
stek3.forEach((x,j)=>{
	switch (x.m){
		//блоки
		//case '(': {rng(x.axe,x.x1,x.y1,x.x2,); break}
		//case '[': {rng(x.axe,x.x1,x.y1+dy,x.x2,); break}				
		case '1':
		case '2':
		case 'a':{recta(x.axe,x.x1,x.y1,x.x2,x.y2,x.m,1,);break}
		//элементы
		case '0':{trg0(x.axe,x.x1,x.y1,x.t);break}// alert(x.t)
		case '3':{trg3(x.axe,x.x1,x.y1,); break}//150+j*5
	}//switch
});//forEach 
  
}

stek4.forEach(x=>{svg.innerHTML+=sq0(1,x[0],x[1],x[2])});// драпировка

const ck=document.querySelectorAll('#svg *');
ck.forEach(x=>{x.addEventListener('click',(e)=>{
	e.target.setAttribute('fill',mainColor)})
	});

}//main
//*****************************************************************//
const cpy=x=>{ // копирование в буфер обмена
	const cop=document.querySelector('#cop');
	cop.value='<svg width="'+s700+'" height="'+hey+'" viewBox="0 0 '+s700+' '+hey+'" fill="none">';
	cop.value+=svg.innerHTML;// пугает /rect да и хрен на него
	cop.value+='</svg>';
	cop.select();
	document.execCommand('copy');
} 

//*********************************  отрисовка
const sq2=(axe,x1,y,x2)=>{// кольцо (+драпировка)
	stek4.unshift([x1,y,x1+x2]);// единственный источник заполнения stek4	
/*	return '<ellipse \r\n'+
'     cx="'+((x1+x2)/2)+'" \r\n'+
'     cy="'+(y-33)+'" \r\n'+
'     rx="'+((x2-x1)/2)+'" \r\n'+
'     ry="10" \r\n'+
'     stroke="blue" \r\n'+
'     fill="violet" \r\n'+
'	 opacity="0"\r\n'+//'+city+'
'     stroke-width="1"/>\r\n'+
'<rect \r\n'+
'	class="rect1" \r\n'+
'	x="'+x1+'" \r\n'+
'	y="'+(y+dy)+'" \r\n'+//axe*
'	width="'+(x2-fy)+'" \r\n'+
'	height="'+(axe*10)+'" \r\n'+
'	opacity="'+city+'"\r\n'+
'	fill="#ffc107" />\r\n';
*/
let f='<polygon\r\n '+
'	class="rect1" \r\n'+
'	points="'+x1+' '+y+' '+
(x1)+' '+((y+axe*dy))+' '+
(x1+x2)+' '+((y+axe*dy))+' '+
(x1+x2)+' '+y+'" \r\n'+
'	opacity="0"\r\n'+
'	fill="red" />\r\n';
f+='<ellipse \r\n'+
'     cx="'+(x1+(x2/2))+'" \r\n'+
'     cy="'+(y+axe*dy-10)+'" \r\n'+//-33
'     rx="'+(x2/2)+'" \r\n'+
'     ry="10" \r\n'+
'     stroke="blue" \r\n'+
'     fill="violet" \r\n'+
'	 opacity="1"\r\n'+//'+city+'
'     stroke-width="1"/>\r\n';
return f;
}
const sq3=(axe,x1,y1)=>// треуг особый
'<polygon\r\n '+
'	class="rect1" \r\n'+
'	points="'+x1+' '+y1+' '+(x1+dx/2|0)+' '+((y1+axe*3*dy))+' '+(x1+dx)+' '+y1+'" \r\n'+
'	opacity="'+city+'"\r\n'+
'	fill="#198754" />\r\n';
const sq4=(axe,x1,y0,name0)=>
'<text class="txt1" x="'+x1+'" y="'+y0+'">'+name0+'</text>\r\n';
const sq5=(axe,x1,y1)=>// треуг
'<polygon \r\n'+
'	class="rect1" \r\n'+
'	points="'+(x1)+' '+y1+' '+(x1+dx/2|0)+' '+(y1+axe*2*dy)+' '+(x1+dx)+' '+y1+'" \r\n'+
'	opacity="'+city+'"\r\n'+
'	fill="blue" />\r\n';
const sq6=()=>'\r\n<style type="text/css">\r\n'+
'.rect1, .polygon1 {stroke: blue;}\r\n'+
'.txt1 {font-family: Arial; font-size: 12px; line-height: 0; fill:white;}\r\n'+
'</style>\r\n'+
'<rect x="0" y="0" width="'+s700+'" height="'+hey+'" fill="white" />\r\n';
const sq7=(axe,x1,y1,x2,y2,m,n)=>// квадрат который не спит на спине
'<rect \r\n'+
'	class="rect1" \r\n'+
'	x="'+x1+'" \r\n'+
'	y="'+(y1+axe*dy)+'" \r\n'+
'	width="'+x2+'" \r\n'+
'	height="'+(axe*y2)+'" \r\n'+
'	opacity="'+city+'"\r\n'+
'	fill="#ffc107" />\r\n';
const sq8=(axe,x1,y1,x2,y2,m,n)=>// список ul
'<polygon \r\n'+
'	class="rect1" \r\n'+
'	points="'+x1+' '+(y1)+' '+(x1+(dx*0.4)|0)+' '+(y1+axe*dy)+' '+(x1+x2)+' '+(y1+axe*dy)+' '+(x1+x2)+' '+(y1)+'" \r\n'+
'	opacity="'+city+'"\r\n'+
'	fill="#ffc107" />\r\n';
const sq9=(axe,x1,y1,x2,y2,m,n)=>// список li
'<polygon  \r\n'+
'	class="rect1" \r\n'+
'	points="'+(x1-(dx*0.1)|0)+' '+(y1)+' '+x1+' '+(y1+axe*dy)+' '+(x1+x2)+' '+(y1+axe*dy)+' '+(x1+x2)+' '+(y1)+'" \r\n'+
'	opacity="'+city+'"\r\n'+
'	fill="#ffc107" />\r\n';
function sq0(axe,x1,y1,x2){// рюмашка (рисуем с 4-ого стека)
	//console.log(x1);
	y1=y1-10;
	let y2=y1+50;
	return `<path 
	class="rect1" 
	d="M${x1+20+yrr['dotx0']} ${y2+z+yrr['doty0']} 
	C${x1+20+yrr['dotx1']} ${y2+yrr['doty1']+z} ${x1-yrr['dotx2']} ${y1+yrr['doty2']+z}
	${x1+yrr['dotx5']} ${y1+z+yrr['doty5']} 
	C${x1-yrr['dotx3']} ${y1+yrr['doty3']+z} ${x1+(x2-x1)/2-yrr['dotx4']} ${y1+yrr['doty4']+z}
	${x1+(x2-x1)/2} ${y1-48} 
	C${x1+(x2-x1)/2+yrr['dotx4']} ${y1+yrr['doty4']+z} ${x2+yrr['dotx3']} ${y1+yrr['doty3']+z}
	${x2-yrr['dotx5']} ${y1+z+yrr['doty5']} 
	C${x2+yrr['dotx2']} ${y1+yrr['doty2']+z} ${x2-20-yrr['dotx1']} ${y2+yrr['doty1']+z}
	${x2-20-yrr['dotx0']} ${y2+z+yrr['doty0']}z"  
	opacity="${city}"
	fill="springgreen" />\r\n`; 
 }
 main();//+z+10
 
 //********************* выбранная точка перемещается курсорными клавишами
 document.addEventListener('keydown', (e) => {// ←↑↓→
 //if(kx===undefined||kx===null)return;
	switch(e.keyCode) {
		case 40: {//↓
		  yrr[ky]=yrr[ky]+1;
		  break;
		}
		case 38: {//↑
		  yrr[ky]=yrr[ky]-1;
		  break;
		}	  
		case 39: {//←
		  yrr[kx]=yrr[kx]-1;
		  break;
		}
		case 37: {//→
		  yrr[kx]=yrr[kx]+1;
		  break;
		}				
		default: break;
	  }
	  x0.innerText=[yrr['dotx0'],yrr['doty0']].join(' ');	  
	  x1.innerText=[yrr['dotx1'],yrr['doty1']].join(' ');
	  x2.innerText=[yrr['dotx2'],yrr['doty2']].join(' ');	  
	  x3.innerText=[yrr['dotx3'],yrr['doty3']].join(' ');	  
	  x4.innerText=[yrr['dotx4'],yrr['doty4']].join(' ');
	  x5.innerText=[yrr['dotx5'],yrr['doty5']].join(' ');	  
	main();  
});
//**************************
selen.onchange(); // выбранная формула юзается для постройки пиалы
</script>
</body>
</html>
